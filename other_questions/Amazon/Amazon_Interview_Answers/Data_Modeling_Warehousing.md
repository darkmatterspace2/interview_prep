# Amazon Data Modeling & Warehousing Interview Questions

## Part 1: Core Concepts & SCD

### Core Concepts

#### 46. Fact vs Dimension — examples from logistics.
**Answer:**
*   **Fact Table:** Contains quantitative data (metrics) and foreign keys. It is the "verb" of the business.
    *   *Example:* `FactShipments` (shipment_id, date_key, customer_key, weight, cost, delivery_time_seconds).
*   **Dimension Table:** Contains descriptive attributes (context). It is the "noun".
    *   *Example:* `DimCarrier` (carrier_id, carrier_name, service_type, reliability_score).

#### 47. Design a shipment fact table.
**Answer:**
*   **Granularity:** One row per shipment event (or per shipment, depending on requirements).
*   **Columns:**
    *   `shipment_sk` (Surrogate Key)
    *   `date_sk` (FK to Date Dimension)
    *   `customer_sk` (FK)
    *   `origin_location_sk` (FK)
    *   `dest_location_sk` (FK)
    *   `carrier_sk` (FK)
    *   **Measures:** `weight_kg`, `shipping_cost`, `distance_miles`, `days_to_deliver`.

#### 48. Design carrier and location dimensions.
**Answer:**
*   **DimCarrier:** `carrier_sk`, `carrier_code`, `carrier_name`, `contract_type`, `region`.
*   **DimLocation:** `location_sk`, `address`, `city`, `state`, `zip_code`, `country`, `location_type` (Warehouse/Residential).

#### 49. Normalize vs denormalize — trade-offs.
**Answer:**
*   **Normalize (3NF):** Reduces redundancy, ensures data integrity. Good for OLTP (Transactional systems). *Trade-off:* Many joins required for reading, slower analytics.
*   **Denormalize (Star Schema):** Redundant data allowed for faster reads. Good for OLAP (Data Warehouse). *Trade-off:* Larger storage, update anomalies risk (though less relevant in append-only analytics).

#### 50. Grain of a table — define and justify.
**Definition:** The level of detail represented by a single row.
*   *Example:* A schema might have a "Daily" grain (one row per product per day) vs. "Transaction" grain (one row per single sale).
*   *Justification:* Always choose the finest grain possible (Atomic grain) for maximum analytical flexibility, then aggregate up for performance if needed.

---

### Slowly Changing Dimensions (SCD)

#### 51. SCD Type 1 vs Type 2 — when to use?
**Answer:**
*   **Type 1 (Overwrite):** No history kept. Use when previous values are incorrect or irrelevant.
    *   *Example:* Correcting a typo in a street address.
*   **Type 2 (Add New Row):** History preserved. Use when tracking changes over time is required.
    *   *Example:* Customer moves from NY to CA. We want to know that *last year's* shipments went to NY, not CA.

#### 52. Track carrier name changes over time.
**Answer:**
Use **SCD Type 2**.
*   Add columns `effective_start_date`, `effective_end_date`, and `is_current_flag`.
*   When name changes: 
    1. Update old row: set `end_date` = now, `is_current` = false.
    2. Insert new row: set `start_date` = now, `end_date` = NULL (or future), `is_current` = true.

#### 53. Handle late-arriving dimension records.
**Problem:** Fact record arrives (Sale) but the new Product dimension record hasn't arrived yet.
**Answer:**
Create a "stub" or "inference" dimension record.
*   Insert a placeholder row in the Dimension table with the unknown ID and distinct values (e.g., "Unknown" or "Pending").
*   Update this record with actual attributes when the dimension data finally arrives (Type 1 update on the stub).

#### 54. Backfill historical data safely.
**Answer:**
1.  **Idempotency:** Ensure the backfill job can run multiple times without duplicating data (use `DELETE` before `INSERT` for the specific time range).
2.  **Partitions:** Process data by partition (e.g., day by day).
3.  **Isolation:** Write to a staging table first, validate, then swap or merge into the main table.

#### 55. Maintain surrogate keys.
**Answer:**
Surrogate keys are independent of business keys (source IDs). They are usually sequential integers generated by the Warehouse (e.g., `IDENTITY` column in Redshift/Snowflake) or hashes (e.g., MD5 of business key) if distributed generation is needed to avoid locking.

---

### Analytics Design

#### 56. Design tables for dashboard reporting.
**Answer:**
Create **Aggregate Tables** (OLAP Cubes/Materialized Views) on top of the atomic fact tables.
*   *Example:* `Agg_Daily_Shipments_By_Region`. Pre-calculate `SUM(shipments)` and `AVG(delay)` grouped by Day and Region. This makes dashboards load instantly.

#### 57. Optimize tables for frequent joins.
**Answer:**
1.  **Co-location:** Use the same Distribution Key (e.g., `shipment_id` or `customer_id`) on both tables so they reside on the same node.
2.  **Star Schema:** Join broad Fact tables to small Dimension tables (Broadcast join).

#### 58. Partition strategy for time-series data.
**Answer:**
Partition by **Time** (Date, Month, or Year).
*   Allows "Partition Pruning": Queries filtering `WHERE date = '2023-01-01'` only scan that specific folder/block, skipping 99% of data.

#### 59. Handle schema evolution.
**Answer:**
*   **Backward Compatible:** Adding a nullable column is safe.
*   **Breaking Changes:** Renaming or deleting columns requires:
    1.  Creating a new version of the table.
    2.  Migrating data.
    3.  Using Views to abstraction the physical table name from users.

#### 60. Cold vs hot data separation.
**Answer:**
*   **Hot Data:** Recent (e.g., last 3 months). Store in high-performance storage (Redshift SSD, DynamoDB).
*   **Cold Data:** Historical (older than 1 year). Offload to cheaper, slower storage (S3 Glacier, or Redshift Spectrum/External Tables) to save cost.

---

## Part 2: Amazon Data Modeling Scenarios

#### 1. Dimensional Modeling: "Delivery Accuracy" Star Schema
**Question:** Design Fact and Dimension tables for analyzing Delivery Accuracy.
**Answer:**
*   **Fact Table:** `FactDelivery`
    *   *Grain:* One row per delivery attempt.
    *   *Measures:* `is_on_time` (0/1), `minutes_late`, `delivery_cost`.
    *   *Keys:* `date_sk`, `driver_sk`, `address_sk`, `hub_sk`.
*   **Dim Tables:**
    *   `DimDriver`: details about the driver.
    *   `DimHub`: details about the warehouse/hub.
    *   `DimDeliveryMethod`: truck, drone, walker.

#### 2. SCD Scenario: Fulfillment Center Region Change
**Question:** A Fulfillment Center changes its region. How to handle?
**Answer:**
Use **SCD Type 2** on the `DimFulfillmentCenter` table.
*   We need to preserve history so that reports for *last year* attribute shipments to the *old* region.
*   Reports for *today* attribute shipments to the *new* region.
*   Simply overwriting (Type 1) would falsify historical regional performance reports.

#### 3. Graph vs Relational: Logistics Network
**Question:** Model a network of cities and routes to calculate capacity.
**Answer:**
*   **Relational Approach:** `Cities` table and `Routes` table (SourceID, DestID, Distance).
    *   *Pro:* Standard, easy to query direct paths.
    *   *Con:* Complex recursive queries (CTEs) needed to find multi-hop paths (A -> B -> C -> D).
*   **Graph Database (Amazon Neptune/Neo4j):** Nodes = Cities, Edges = Routes.
    *   *Pro:* "Shortest Path" or "Max Flow" algorithms are native and extremely fast.
    *   *Verdict:* For simple point-to-point, Relational is fine. For complex network optimization & routing, **Graph** is superior.
